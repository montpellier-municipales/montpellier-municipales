<!-- Copilot / AI agent instructions for quick onboarding -->
# Quick onboard: Montpellier Municipales (Qwik + QwikCity)

This file gives focused, actionable guidance for AI coding agents working in this repository. Keep it concise and reference concrete files and patterns.

**Big Picture**
- **Framework:** Qwik + QwikCity (SSR/resumability). See `src/entry.ssr.tsx` and `src/entry.preview.tsx` for server entry points.
- **Routing:** Directory-based routes under `src/routes/`. Dynamic segments use bracket syntax (e.g. `src/routes/[lang]/`, `src/routes/listes/[id]/`).
- **I18n:** Uses `qwik-speak`. Configuration in `src/speak-config.ts`. Translation assets live in `src/i18n/{lang}/app.json`.
- **Content:** Markdown blog posts in `src/content/blog` and JSON lists in `src/content/lists`.
- **Styling:** Vanilla Extract CSS modules (`*.css.ts`) next to components and routes (see `src/components/*` and `src/routes/*.css.ts`).

**Key scripts / developer workflows**
- Dev (SSR): `pnpm dev` (alias: `npm run dev`) — launches Vite in SSR mode (`vite --mode ssr`).
- Start (dev with open): `pnpm start` — `vite --open --mode ssr`.
- Build (production): `pnpm build` — runs `qwik build` (client + server/manifest). Use `pnpm build.server` for the static adapter build (see below).
- Preview production build locally: `pnpm preview` (runs the preview build + `vite preview`).
- Typecheck only: `pnpm run build.types`.
- Lint / format: `pnpm run lint`, `pnpm run fmt`, `pnpm run fmt.check`.

If the repo uses pnpm (lockfile present), prefer `pnpm` in examples.

**Important files to read before making changes**
- `src/entry.ssr.tsx` — SSR entry; sets HTML `lang` and base path for client assets using `serverData.locale`.
- `src/speak-config.ts` — supported locales and default locale.
- `src/routes/index.tsx` and `src/routes/[lang]/index.tsx` — examples of `routeLoader$` and server-side data loading (`useLists`).
- `src/services/blog.ts` — how blog posts are discovered and parsed (pattern: `slug.{lang}.md`).
- `src/services/lists.ts` — reads `src/content/lists/{id}.json` to populate lists.
- `adapters/static/vite.config.ts` — adapter-specific build config used by `npm run build.server`.

**Project-specific conventions and examples**
- Blog filename convention: `src/content/blog/{slug}.{lang}.md` (e.g. `lancement.fr.md`). The service `getBlogPosts(lang)` filters files by `.${lang}.md`.
- Lists: `src/content/lists/{id}.json` and loaded with `getList(id)` in `src/services/lists.ts`.
- Translation assets: `src/i18n/{lang}/app.json`. `qwik-speak` loads the `app` asset as configured in `src/speak-config.ts`.
- Route data loading: prefer `routeLoader$` for server-side data (see `src/routes/index.tsx` using `useLists`).
- Client asset base per-locale: `src/entry.ssr.tsx` uses `serverData.locale` to set the `base` (produces `/build/{locale}` builds in non-dev mode).

**Integration points & external dependencies**
- Qwik & QwikCity: core framework (see `package.json`).
- `qwik-speak` for i18n — check `src/speak-config.ts` and `src/speak-functions.ts` for helpers.
- Content parsing: `gray-matter` + `marked` (see `src/services/blog.ts`).
- Static adapter: static site build driven by `adapters/static/vite.config.ts` and `npm run build.server`.

**How to add content or a language (practical examples)**
- Add a translation: create `src/i18n/<lang>/app.json` with the same keys as `fr/app.json`.
- Add a blog post for French: create `src/content/blog/my-post.fr.md` with frontmatter (title, date, excerpt, author) — `src/services/blog.ts` expects frontmatter and converts markdown to HTML.
- Add a list: add `src/content/lists/{id}.json` matching `types/schema.ts` (used by `getList`).

**Common pitfalls and troubleshooting hints**
- Missing locale-specific build: In production builds, client chunks are expected under `/build/{locale}`. If assets 404, check `serverData.locale` and `extractBase` in `src/entry.ssr.tsx`.
- File reads at runtime: services use `process.cwd()` to locate `src/content/*`. When running from a different working directory or packaged build, verify paths or use adapter-friendly file handling.
- If adding a new route, ensure filename matches QwikCity conventions and export `head`/`routeLoader$` as needed.

**What not to change without checking first**
- The `extractBase` logic in `src/entry.ssr.tsx` (affects where client assets are loaded).
- `speak-config.ts` locales list — adding/removing locales affects build outputs and asset structure.

If anything is unclear or you need more examples (e.g. adding a new adapter, SSG vs SSR details, or data shape for lists), please tell me which area to expand and I will update this document.

---
Last updated: auto-generated by AI. Reply with requested clarifications to iterate.
